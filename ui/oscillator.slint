import { Button, Slider, Switch, SpinBox, HorizontalBox } from "std-widgets.slint";
import { Heading, Label, StartButton, WaveSelector, LevelSlider, OutputLevelSlider, ADSRSlider, ActivationSwitch } from "../ui/components.slint";
import { Theme } from "../ui/theme.slint";

export component AppWindow inherits Window {
    title: Theme.window-title;
    min-width: Theme.window-width;
    min-height: Theme.window-height;
    default-font-size: Theme.text-size;
    background: transparent;

    in-out property <bool> start_button_active: true;

    callback start_button_pressed(bool);
    callback wave_shape1_selected(string);
    callback wave_shape2_selected(string);
    callback wave_shape3_selected(string);
    callback sub_shape_selected(string);
    callback wave_level1_selected(float);
    callback wave_level2_selected(float);
    callback wave_level3_selected(float);
    callback sub_level_selected(float);
    callback wave_detune_value_changed(float);
    callback wave_detune_stage_changed(bool, float);
    callback output_level_value_changed(int);
    callback envelope_attack_updated(int);
    callback envelope_decay_updated(int);
    callback envelope_release_updated(int);
    callback envelope_sustain_updated(int);
    callback envelope_sustain_level_updated(int);
    callback filter_cutoff_value_changed(int);
    callback filter_resonance_value_changed(float);

    Rectangle {
        padding: 4px;
        border-width: Theme.window-border-width;
        background: Theme.window-background;
        border-color: Theme.border-colour;
        border-bottom-left-radius: Theme.border-radius;
        border-bottom-right-radius: Theme.border-radius;

        HorizontalLayout {
            alignment: center;
            spacing: 20px;

            VerticalLayout {
                vertical-stretch: 1;
                alignment: center;
                spacing: 30px;

                HorizontalLayout {
                    alignment: center;
                    spacing: 20px;

                    VerticalLayout {
                        spacing: 10px;

                        Heading {
                            horizontal-alignment: center;
                            heading: Theme.oscillator1-heading-text;
                        }

                        Label {
                            horizontal-alignment: center;
                            label: Theme.oscillator-level-text;
                        }

                        osc1_level := LevelSlider {
                            level: Theme.osc-level-slider-default;
                            level-step: Theme.osc-level-slider-step;
                            minimum-level: Theme.osc-level-slider-minimum;
                            maximum-level: Theme.osc-level-slider-maximum;

                            level_selected(level) => {
                                root.wave_level1_selected(level / 100);
                            }
                        }

                        osc1_selector := WaveSelector {
                            wave_shape_selected(shape) => {
                                root.wave_shape1_selected(shape);
                            }
                        }
                    }

                    VerticalLayout {
                        spacing: 10px;

                        Heading {
                            horizontal-alignment: center;
                            heading: Theme.oscillator2-heading-text;
                        }

                        Label {
                            horizontal-alignment: center;
                            label: Theme.oscillator-level-text;
                        }

                        osc2_level := LevelSlider {
                            level: Theme.osc-level-slider-default;
                            level-step: Theme.osc-level-slider-step;
                            minimum-level: Theme.osc-level-slider-minimum;
                            maximum-level: Theme.osc-level-slider-maximum;

                            level_selected(level) => {
                                root.wave_level2_selected(level / 100);
                            }
                        }

                        osc2_selector := WaveSelector {
                            wave_shape_selected(shape) => {
                                root.wave_shape2_selected(shape);
                            }
                        }
                    }

                    VerticalLayout {
                        spacing: 10px;

                        Heading {
                            horizontal-alignment: center;
                            heading: Theme.oscillator3-heading-text;
                        }

                        Label {
                            horizontal-alignment: center;
                            label: Theme.oscillator-level-text;
                        }

                        osc3_level := LevelSlider {
                            level: Theme.osc-level-slider-default;
                            level-step: Theme.osc-level-slider-step;
                            minimum-level: Theme.osc-level-slider-minimum;
                            maximum-level: Theme.osc-level-slider-maximum;

                            level_selected(level) => {
                                root.wave_level3_selected(level / 100);
                            }
                        }

                        osc3_selector := WaveSelector {
                            wave_shape_selected(shape) => {
                                root.wave_shape3_selected(shape);
                            }
                        }
                    }
                }

                HorizontalLayout {
                    alignment: center;
                    spacing: 20px;

                    VerticalLayout {
                        spacing: 10px;

                        Heading {
                            horizontal-alignment: center;
                            heading: Theme.sub-oscillator-heading-text;
                        }

                        Label {
                            horizontal-alignment: center;
                            label: Theme.sub-oscillator-level-text;
                        }

                        sub_level := LevelSlider {
                            level: Theme.sub-level-slider-default;
                            level-step: Theme.osc-level-slider-step;
                            minimum-level: Theme.osc-level-slider-minimum;
                            maximum-level: Theme.osc-level-slider-maximum;

                            level_selected(level) => {
                                root.sub_level_selected(level / 100);
                            }
                        }

                        sub_selector := WaveSelector {
                            wave_shape_selected(shape) => {
                                root.sub_shape_selected(shape);
                            }
                        }
                    }

                    VerticalLayout {
                        spacing: 10px;

                        Heading {
                            horizontal-alignment: center;
                            heading: Theme.detune-heading-text;
                        }

                        Label {
                            horizontal-alignment: center;
                            label: round(detune_amount.value) + Theme.detune-amount-label-suffix;
                        }

                        detune_amount := LevelSlider {
                            level: Theme.detune-amount-slider-default;
                            level-step: Theme.osc-level-slider-step;
                            minimum-level: Theme.osc-level-slider-minimum;
                            maximum-level: Theme.osc-level-slider-maximum;
                            enabled: false;
                            level_selected(level) => {
                                wave_detune_value_changed(level / 100);
                            }
                        }

                        ActivationSwitch {
                            activation_toggled => {
                                detune_amount.enabled = self.activated;
                                wave_detune_stage_changed(self.activated, round(detune_amount.level) / 100);
                            }
                        }
                    }

                    VerticalLayout {
                        spacing: 10px;

                        Heading {
                            horizontal-alignment: center;
                            heading: Theme.output-level-heading-text;
                        }

                        Label {
                            horizontal-alignment: center;
                            label: round(output_level.value) - 100 + Theme.output-level-label-suffix;
                        }

                        output_level := LevelSlider {
                            level: Theme.output-level-slider-default;
                            level-step: Theme.output-level-slider-step;
                            minimum-level: Theme.output-level-slider-minimum;
                            maximum-level: Theme.output-level-slider-maximum;
                            level_selected(level) => {
                                root.output_level_value_changed(level - 100);
                            }
                        }
                    }
                }

                HorizontalLayout {
                    spacing: 30px;
                    start_button := StartButton {
                        active: start_button_active;
                        tone_start_button_pressed(active) => {
                            root.start_button_pressed(active);
                        }
                    }
                }
            }

            VerticalLayout {
                alignment: center;

                Rectangle {
                    horizontal-stretch: 1;
                    height: Theme.window-height - 20px;
                    border-width: Theme.window-border-width;
                    border-color: Theme.border-colour;
                    border-radius: Theme.border-radius;
                    background: Theme.adrs-box-background;

                    VerticalLayout {
                        vertical-stretch: 1;
                        alignment: center;
                        spacing: 30px;
                        padding: 20px;

                        HorizontalLayout {
                            alignment: center;
                            spacing: 20px;

                            Heading {
                                horizontal-alignment: center;
                                heading: Theme.filter-header-text;
                            }
                        }

                        HorizontalLayout {
                            spacing: 20px;

                            VerticalLayout {
                                spacing: 10px;


                                Label {
                                    horizontal-alignment: center;
                                    label: Theme.filter-cutoff-text;
                                }

                                Label {
                                    horizontal-alignment: center;
                                    label: filter_cutoff.level + Theme.filter-cutoff-suffix;
                                }

                                filter_cutoff := LevelSlider {
                                    height: 200px;
                                    orientation: vertical;

                                    level: Theme.filter-cutoff-slider-default;
                                    level-step: Theme.filter-cutoff-slider-step;
                                    minimum-level: Theme.filter-cutoff-slider-minimum;
                                    maximum-level: Theme.filter-cutoff-slider-maximum;
                                    level_selected(level) => {
                                        filter_cutoff_value_changed(level);
                                    }
                                }
                            }

                            VerticalLayout {
                                spacing: 10px;

                                Label {
                                    horizontal-alignment: center;
                                    label: Theme.filter-resonance-text;
                                }

                                Label {
                                    horizontal-alignment: center;
                                    label: 100 - filter_resonance.level;
                                }

                                filter_resonance := LevelSlider {
                                    orientation: vertical;
                                    height: 200px;

                                    level: Theme.filter-resonance-slider-default;
                                    level-step: Theme.filter-resonance-slider-step;
                                    minimum-level: Theme.filter-resonance-slider-minimum;
                                    maximum-level: Theme.filter-resonance-slider-maximum;
                                    level_selected(level) => {
                                        filter_resonance_value_changed((100 - level)/100);
                                    }
                                }
                            }
                        }
                    }
                }
            }

            VerticalLayout {
                alignment: center;

                Rectangle {
                    horizontal-stretch: 1;
                    height: Theme.window-height - 20px;
                    border-width: Theme.window-border-width;
                    border-color: Theme.border-colour;
                    border-radius: Theme.border-radius;
                    background: Theme.adrs-box-background;

                    VerticalLayout {
                        vertical-stretch: 1;
                        alignment: center;
                        spacing: 30px;
                        padding: 20px;

                        HorizontalLayout {
                            alignment: center;
                            spacing: 20px;

                            Heading {
                                horizontal-alignment: center;
                                heading: Theme.envelope-header-text;
                            }
                        }

                        HorizontalLayout {
                            spacing: 20px;

                            VerticalLayout {
                                Label {
                                    horizontal-alignment: center;
                                    label: Theme.envelope-attack-text;
                                }

                                Label {
                                    horizontal-alignment: center;
                                    label: attack_time.milliseconds + Theme.envelope-time-suffix;
                                }

                                attack_time := ADSRSlider {
                                    milliseconds: Theme.envelope-attack-default;
                                    milliseconds_selected(milliseconds) => {
                                        root.envelope_attack_updated(milliseconds);
                                    }
                                }
                            }

                            VerticalLayout {
                                Label {
                                    horizontal-alignment: center;
                                    label: Theme.envelope-decay-text;
                                }

                                Label {
                                    horizontal-alignment: center;
                                    label: decay_time.milliseconds + Theme.envelope-time-suffix;
                                }

                                decay_time := ADSRSlider {
                                    milliseconds: Theme.envelope-decay-default;
                                    milliseconds_selected(milliseconds) => {
                                        root.envelope_decay_updated(milliseconds);
                                    }
                                }
                            }
                        }

                        HorizontalLayout {
                            spacing: 20px;

                            VerticalLayout {
                                Label {
                                    horizontal-alignment: center;
                                    label: Theme.envelope-sustain-text;
                                }

                                Label {
                                    horizontal-alignment: center;
                                    label: sustain_time.milliseconds + Theme.envelope-time-suffix;
                                }

                                sustain_time := ADSRSlider {
                                    milliseconds: Theme.envelope-sustain-default;
                                    milliseconds_selected(milliseconds) => {
                                        root.envelope_sustain_updated(milliseconds);
                                    }
                                }
                            }

                            VerticalLayout {
                                Label {
                                    horizontal-alignment: center;
                                    label: Theme.envelope-sustain-level-text;
                                }

                                Label {
                                    horizontal-alignment: center;
                                    label: Theme.envelope-sustain-level-prefix + sustain_level.level + Theme.envelope-sustain-level-suffix;
                                }

                                sustain_level := LevelSlider {
                                    level: Theme.envelope-sustain-level-default;
                                    step: Theme.envelope-sustain-level-step;
                                    minimum: Theme.envelope-sustain-level-minimum;
                                    maximum: Theme.envelope-sustain-level-maximum;

                                    level_selected(dbfs) => {
                                        root.envelope_sustain_level_updated(dbfs);
                                    }
                                }
                            }
                        }

                        HorizontalLayout {
                            spacing: 20px;

                            VerticalLayout {
                                Label {
                                    horizontal-alignment: center;
                                    label: Theme.envelope-release-text;
                                }

                                Label {
                                    horizontal-alignment: center;
                                    label: release_time.milliseconds + Theme.envelope-time-suffix;
                                }

                                release_time := ADSRSlider {
                                    milliseconds: Theme.envelope-release-default;
                                    milliseconds_selected(milliseconds) => {
                                        root.envelope_release_updated(milliseconds);
                                    }
                                }
                            }
                        }
                    }
                }
            }


        }
    }
}
