use rand::prelude::*;


const MIDI_NOTE_FREQUENCIES: [(&str, f32); 128] = [
    //("C-1", 8.1758),
    ("Rest", 0.0), // 0
    ("C#-1/Db-1", 8.6620),
    ("D-1", 9.1770),
    ("D#-1/Eb-1", 9.7227),
    ("E-1", 10.3009),
    ("F-1", 10.9134),
    ("F#-1/Gb-1", 11.5623),
    ("G-1", 12.2499),
    ("G#-1/Ab-1", 12.9783),
    ("A-1", 13.7500),
    ("A#-1/Bb-1", 14.5676),
    ("B-1", 15.4339),
    ("C0", 16.3516), // 12
    ("C#0/Db0", 17.3239),
    ("D0", 18.3540),
    ("D#0/Eb0", 19.4454),
    ("E0", 20.6017),
    ("F0", 21.8268),
    ("F#0/Gb0", 23.1247),
    ("G0", 24.4997),
    ("G#0/Ab0", 25.9565),
    ("A0", 27.5000),
    ("A#0/Bb0", 29.1352),
    ("B0", 30.8677),
    ("C1", 32.7032), // 24
    ("C#1/Db1", 34.6478),
    ("D1", 36.7081),
    ("D#1/Eb1", 38.8909),
    ("E1", 41.2034),
    ("F1", 43.6535),
    ("F#1/Gb1", 46.2493),
    ("G1", 48.9994),
    ("G#1/Ab1", 51.9131),
    ("A1", 55.0000),
    ("A#1/Bb1", 58.2705),
    ("B1", 61.7354),
    ("C2", 65.4064), // 36
    ("C#2/Db2", 69.2957),
    ("D2", 73.4162),
    ("D#2/Eb2", 77.7817),
    ("E2", 82.4069),
    ("F2", 87.3071),
    ("F#2/Gb2", 92.4986),
    ("G2", 97.9989),
    ("G#2/Ab2", 103.8262),
    ("A2", 110.0000),
    ("A#2/Bb2", 116.5409),
    ("B2", 123.4708),
    ("C3", 130.8128), // 48
    ("C#3/Db3", 138.5913),
    ("D3", 146.8324),
    ("D#3/Eb3", 155.5635),
    ("E3", 164.8138),
    ("F3", 174.6141),
    ("F#3/Gb3", 184.9972),
    ("G3", 195.9977),
    ("G#3/Ab3", 207.6523),
    ("A3", 220.0000),
    ("A#3/Bb3", 233.0819),
    ("B3", 246.9417),
    ("C4 (middle C)", 261.6256), // 60
    ("C#4/Db4", 277.1826),
    ("D4", 293.6648),
    ("D#4/Eb4", 311.1270),
    ("E4", 329.6276),
    ("F4", 349.2282),
    ("F#4/Gb4", 369.9944),
    ("G4", 391.9954),
    ("G#4/Ab4", 415.3047),
    ("A4", 440.0000),
    ("A#4/Bb4", 466.1638),
    ("B4", 493.8833),
    ("C5", 523.2511), // 72
    ("C#5/Db5", 554.3653),
    ("D5", 587.3295),
    ("D#5/Eb5", 622.2540),
    ("E5", 659.2551),
    ("F5", 698.4565),
    ("F#5/Gb5", 739.9888),
    ("G5", 783.9909),
    ("G#5/Ab5", 830.6094),
    ("A5", 880.0000),
    ("A#5/Bb5", 932.3275),
    ("B5", 987.7666),
    ("C6", 1046.5023), // 84
    ("C#6/Db6", 1108.7305),
    ("D6", 1174.6591),
    ("D#6/Eb6", 1244.5079),
    ("E6", 1318.5102),
    ("F6", 1396.9129),
    ("F#6/Gb6", 1479.9777),
    ("G6", 1567.9817),
    ("G#6/Ab6", 1661.2188),
    ("A6", 1760.0000),
    ("A#6/Bb6", 1864.6550),
    ("B6", 1975.5332),
    ("C7", 2093.0045), // 96
    ("C#7/Db7", 2217.4610),
    ("D7", 2349.3181),
    ("D#7/Eb7", 2489.0159),
    ("E7", 2637.0205),
    ("F7", 2793.8259),
    ("F#7/Gb7", 2959.9554),
    ("G7", 3135.9635),
    ("G#7/Ab7", 3322.4376),
    ("A7", 3520.0000),
    ("A#7/Bb7", 3729.3101),
    ("B7", 3951.0664),
    ("C8", 4186.0090), // 108
    ("C#8/Db8", 4434.9221),
    ("D8", 4698.6363),
    ("D#8/Eb8", 4978.0317),
    ("E8", 5274.0409),
    ("F8", 5587.6517),
    ("F#8/Gb8", 5919.9108),
    ("G8", 6271.9270),
    ("G#8/Ab8", 6644.8752),
    ("A8", 7040.0000),
    ("A#8/Bb8", 7458.6202),
    ("B8", 7902.1328),
    ("C9", 8372.0181), // 120
    ("C#9/Db9", 8869.8442),
    ("D9", 9397.2726),
    ("D#9/Eb9", 9956.0635),
    ("E9", 10548.0818),
    ("F9", 11175.3034),
    ("F#9/Gb9", 11839.8215),
    ("G9", 12543.8540),
];

pub struct Sequencer {
    sequence: Vec<u32>,
    sequence_index: usize,
}

impl Sequencer {
    pub fn new(sequence: Vec<u32>) -> Sequencer {
        Sequencer {
            sequence,
            sequence_index: 0,
        }
    }

    pub fn next_note_frequency(&mut self) -> f32 {
        let index = rand::rng().random_range(0..self.sequence.len());
        let midi_note = self.sequence[index];

        if self.sequence_index < self.sequence.len() - 1 {
            self.sequence_index += 1;
        } else {
            self.sequence_index = 0;
        }

        MIDI_NOTE_FREQUENCIES[midi_note as usize].1
    }
}
